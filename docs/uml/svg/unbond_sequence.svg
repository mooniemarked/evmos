<svg xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink" width="1429" height="989" contentScriptType="application/ecmascript" contentStyleType="text/css" preserveAspectRatio="none" style="width:1429px;height:989px" version="1.1" viewBox="0 0 1429 989" zoomAndPan="magnify"><defs><filter id="f1harfv0wr5n65" width="300%" height="300%" x="-1" y="-1"><feGaussianBlur result="blurOut" stdDeviation="2"/><feColorMatrix in="blurOut" result="blurOut2" type="matrix" values="0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 .4 0"/><feOffset dx="4" dy="4" in="blurOut2" result="blurOut3"/><feBlend in="SourceGraphic" in2="blurOut3" mode="normal"/></filter></defs><g><text x="660.25" y="28.708" fill="#000" font-family="sans-serif" font-size="18" lengthAdjust="spacing" textLength="105">Undelegate</text><rect width="640.5" height="46.266" x="20" y="190.516" fill="#FFF" filter="url(#f1harfv0wr5n65)" style="stroke:#000;stroke-width:2"/><rect width="1405.5" height="551.344" x="10" y="250.781" fill="#FFF" filter="url(#f1harfv0wr5n65)" style="stroke:#000;stroke-width:2"/><rect width="640.5" height="46.266" x="20" y="317.047" fill="#FFF" filter="url(#f1harfv0wr5n65)" style="stroke:#000;stroke-width:2"/><rect width="640.5" height="46.266" x="20" y="377.313" fill="#FFF" filter="url(#f1harfv0wr5n65)" style="stroke:#000;stroke-width:2"/><rect width="619" height="82.68" x="304" y="437.578" fill="#FFF" filter="url(#f1harfv0wr5n65)" style="stroke:#000;stroke-width:2"/><rect width="455" height="132.336" x="570.5" y="534.258" fill="#FFF" filter="url(#f1harfv0wr5n65)" style="stroke:#000;stroke-width:2"/><rect width="455" height="86.07" x="570.5" fill="#FFF" style="stroke:none;stroke-width:1" y="580.523"/><rect width="835" height="56.266" x="570.5" y="738.859" fill="#FFF" filter="url(#f1harfv0wr5n65)" style="stroke:#000;stroke-width:2"/><rect width="572" height="46.266" x="570.5" y="816.125" fill="#FFF" filter="url(#f1harfv0wr5n65)" style="stroke:#000;stroke-width:2"/><line style="stroke:#a80036;stroke-width:1;stroke-dasharray:5,5" x1="77" x2="77" y1="102.25" y2="921.523"/><line style="stroke:#a80036;stroke-width:1;stroke-dasharray:5,5" x1="615.5" x2="615.5" y1="102.25" y2="921.523"/><line style="stroke:#a80036;stroke-width:1;stroke-dasharray:5,5" x1="993.5" x2="993.5" y1="102.25" y2="921.523"/><line style="stroke:#a80036;stroke-width:1;stroke-dasharray:5,5" x1="1078.5" x2="1078.5" y1="102.25" y2="921.523"/><rect width="91" height="30.297" x="30" y="66.953" fill="#FEFECE" filter="url(#f1harfv0wr5n65)" style="stroke:#a80036;stroke-width:1.5"/><text x="37" y="86.948" fill="#000" font-family="sans-serif" font-size="14" lengthAdjust="spacing" textLength="77">msgServer</text><rect width="91" height="30.297" x="30" y="920.523" fill="#FEFECE" filter="url(#f1harfv0wr5n65)" style="stroke:#a80036;stroke-width:1.5"/><text x="37" y="940.519" fill="#000" font-family="sans-serif" font-size="14" lengthAdjust="spacing" textLength="77">msgServer</text><rect width="66" height="30.297" x="580.5" y="66.953" fill="#FEFECE" filter="url(#f1harfv0wr5n65)" style="stroke:#a80036;stroke-width:1.5"/><text x="587.5" y="86.948" fill="#000" font-family="sans-serif" font-size="14" lengthAdjust="spacing" textLength="52">keeper</text><rect width="66" height="30.297" x="580.5" y="920.523" fill="#FEFECE" filter="url(#f1harfv0wr5n65)" style="stroke:#a80036;stroke-width:1.5"/><text x="587.5" y="940.519" fill="#000" font-family="sans-serif" font-size="14" lengthAdjust="spacing" textLength="52">keeper</text><text x="971.5" y="98.948" fill="#000" font-family="sans-serif" font-size="14" lengthAdjust="spacing" textLength="38">store</text><path fill="#FEFECE" d="M975.5,49.9531 C975.5,39.9531 993.5,39.9531 993.5,39.9531 C993.5,39.9531 1011.5,39.9531 1011.5,49.9531 L1011.5,75.9531 C1011.5,85.9531 993.5,85.9531 993.5,85.9531 C993.5,85.9531 975.5,85.9531 975.5,75.9531 L975.5,49.9531" filter="url(#f1harfv0wr5n65)" style="stroke:#000;stroke-width:1.5"/><path fill="none" d="M975.5,49.9531 C975.5,59.9531 993.5,59.9531 993.5,59.9531 C993.5,59.9531 1011.5,59.9531 1011.5,49.9531" style="stroke:#000;stroke-width:1.5"/><text x="971.5" y="933.519" fill="#000" font-family="sans-serif" font-size="14" lengthAdjust="spacing" textLength="38">store</text><path fill="#FEFECE" d="M975.5,946.8203 C975.5,936.8203 993.5,936.8203 993.5,936.8203 C993.5,936.8203 1011.5,936.8203 1011.5,946.8203 L1011.5,972.8203 C1011.5,982.8203 993.5,982.8203 993.5,982.8203 C993.5,982.8203 975.5,982.8203 975.5,972.8203 L975.5,946.8203" filter="url(#f1harfv0wr5n65)" style="stroke:#000;stroke-width:1.5"/><path fill="none" d="M975.5,946.8203 C975.5,956.8203 993.5,956.8203 993.5,956.8203 C993.5,956.8203 1011.5,956.8203 1011.5,946.8203" style="stroke:#000;stroke-width:1.5"/><rect width="103" height="30.297" x="1025.5" y="66.953" fill="#FEFECE" filter="url(#f1harfv0wr5n65)" style="stroke:#a80036;stroke-width:1.5"/><text x="1032.5" y="86.948" fill="#000" font-family="sans-serif" font-size="14" lengthAdjust="spacing" textLength="89">bankKeeper</text><rect width="103" height="30.297" x="1025.5" y="920.523" fill="#FEFECE" filter="url(#f1harfv0wr5n65)" style="stroke:#a80036;stroke-width:1.5"/><text x="1032.5" y="940.519" fill="#000" font-family="sans-serif" font-size="14" lengthAdjust="spacing" textLength="89">bankKeeper</text><polygon fill="#A80036" points="603.5 129.383 613.5 133.383 603.5 137.383 607.5 133.383" style="stroke:#a80036;stroke-width:1"/><line style="stroke:#a80036;stroke-width:1" x1="77.5" x2="609.5" y1="133.383" y2="133.383"/><text x="84.5" y="128.317" fill="#000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="284">Undelegate(delAddr, valAddr, tokenAmount)</text><line style="stroke:#a80036;stroke-width:1" x1="615.5" x2="657.5" y1="162.516" y2="162.516"/><line style="stroke:#a80036;stroke-width:1" x1="657.5" x2="657.5" y1="162.516" y2="175.516"/><line style="stroke:#a80036;stroke-width:1" x1="616.5" x2="657.5" y1="175.516" y2="175.516"/><polygon fill="#A80036" points="626.5 171.516 616.5 175.516 626.5 179.516 622.5 175.516" style="stroke:#a80036;stroke-width:1"/><text x="622.5" y="157.45" fill="#000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="364">calculate number of shares the tokenAmount represents</text><path fill="#EEE" d="M20,190.5156 L86,190.5156 L86,197.5156 L76,207.5156 L20,207.5156 L20,190.5156" style="stroke:#000;stroke-width:1"/><rect width="640.5" height="46.266" x="20" fill="none" style="stroke:#000;stroke-width:2" y="190.516"/><text x="35" y="203.583" fill="#000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacing" textLength="21">alt</text><text x="101" y="202.726" fill="#000" font-family="sans-serif" font-size="11" font-weight="bold" lengthAdjust="spacing" textLength="100">[wrong denom]</text><polygon fill="#A80036" points="88.5 224.781 78.5 228.781 88.5 232.781 84.5 228.781" style="stroke:#a80036;stroke-width:1"/><line style="stroke:#a80036;stroke-width:1;stroke-dasharray:2,2" x1="82.5" x2="614.5" y1="228.781" y2="228.781"/><text x="94.5" y="223.715" fill="#000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="31">error</text><path fill="#EEE" d="M10,250.7813 L306,250.7813 L306,257.7813 L296,267.7813 L10,267.7813 L10,250.7813" style="stroke:#000;stroke-width:1"/><rect width="1405.5" height="551.344" x="10" fill="none" style="stroke:#000;stroke-width:2" y="250.781"/><text x="25" y="263.848" fill="#000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacing" textLength="251">Unbond(delAddr, valAddr, shares)</text><line style="stroke:#a80036;stroke-width:1" x1="615.5" x2="657.5" y1="289.047" y2="289.047"/><line style="stroke:#a80036;stroke-width:1" x1="657.5" x2="657.5" y1="289.047" y2="302.047"/><line style="stroke:#a80036;stroke-width:1" x1="616.5" x2="657.5" y1="302.047" y2="302.047"/><polygon fill="#A80036" points="626.5 298.047 616.5 302.047 626.5 306.047 622.5 302.047" style="stroke:#a80036;stroke-width:1"/><text x="622.5" y="283.981" fill="#000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="243">BeforeDelegationSharesModified hook</text><path fill="#EEE" d="M20,317.0469 L86,317.0469 L86,324.0469 L76,334.0469 L20,334.0469 L20,317.0469" style="stroke:#000;stroke-width:1"/><rect width="640.5" height="46.266" x="20" fill="none" style="stroke:#000;stroke-width:2" y="317.047"/><text x="35" y="330.114" fill="#000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacing" textLength="21">alt</text><text x="101" y="329.257" fill="#000" font-family="sans-serif" font-size="11" font-weight="bold" lengthAdjust="spacing" textLength="137">[no such delegation]</text><polygon fill="#A80036" points="88.5 351.313 78.5 355.313 88.5 359.313 84.5 355.313" style="stroke:#a80036;stroke-width:1"/><line style="stroke:#a80036;stroke-width:1;stroke-dasharray:2,2" x1="82.5" x2="614.5" y1="355.313" y2="355.313"/><text x="94.5" y="350.247" fill="#000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="31">error</text><path fill="#EEE" d="M20,377.3125 L86,377.3125 L86,384.3125 L76,394.3125 L20,394.3125 L20,377.3125" style="stroke:#000;stroke-width:1"/><rect width="640.5" height="46.266" x="20" fill="none" style="stroke:#000;stroke-width:2" y="377.313"/><text x="35" y="390.379" fill="#000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacing" textLength="21">alt</text><text x="101" y="389.523" fill="#000" font-family="sans-serif" font-size="11" font-weight="bold" lengthAdjust="spacing" textLength="135">[not enough shares]</text><polygon fill="#A80036" points="88.5 411.578 78.5 415.578 88.5 419.578 84.5 415.578" style="stroke:#a80036;stroke-width:1"/><line style="stroke:#a80036;stroke-width:1;stroke-dasharray:2,2" x1="82.5" x2="614.5" y1="415.578" y2="415.578"/><text x="94.5" y="410.512" fill="#000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="31">error</text><path fill="#EEE" d="M304,437.5781 L370,437.5781 L370,444.5781 L360,454.5781 L304,454.5781 L304,437.5781" style="stroke:#000;stroke-width:1"/><rect width="619" height="82.68" x="304" fill="none" style="stroke:#000;stroke-width:2" y="437.578"/><text x="319" y="450.645" fill="#000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacing" textLength="21">alt</text><text x="385" y="449.789" fill="#000" font-family="sans-serif" font-size="11" font-weight="bold" lengthAdjust="spacing" textLength="290">[delegator is the operator of the validator</text><text x="385" y="462.593" fill="#000" font-family="sans-serif" font-size="11" font-weight="bold" lengthAdjust="spacing" textLength="225">and validator is not already jailed</text><text x="385" y="475.398" fill="#000" font-family="sans-serif" font-size="11" font-weight="bold" lengthAdjust="spacing" textLength="418">and unbonding would put self-delegation under min threshold]</text><line style="stroke:#a80036;stroke-width:1" x1="615.5" x2="657.5" y1="499.258" y2="499.258"/><line style="stroke:#a80036;stroke-width:1" x1="657.5" x2="657.5" y1="499.258" y2="512.258"/><line style="stroke:#a80036;stroke-width:1" x1="616.5" x2="657.5" y1="512.258" y2="512.258"/><polygon fill="#A80036" points="626.5 508.258 616.5 512.258 626.5 516.258 622.5 512.258" style="stroke:#a80036;stroke-width:1"/><text x="622.5" y="494.192" fill="#000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="289">jail the validator, but proceed with unbonding</text><path fill="#FBFB77" d="M314,484.625 L314,509.625 L606,509.625 L606,494.625 L596,484.625 L314,484.625" filter="url(#f1harfv0wr5n65)" style="stroke:#a80036;stroke-width:1"/><path fill="#FBFB77" d="M596,484.625 L596,494.625 L606,494.625 L596,484.625" style="stroke:#a80036;stroke-width:1"/><text x="320" y="501.692" fill="#000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="271">Default min delegation threshold : 1 share</text><path fill="#EEE" d="M570.5,534.2578 L636.5,534.2578 L636.5,541.2578 L626.5,551.2578 L570.5,551.2578 L570.5,534.2578" style="stroke:#000;stroke-width:1"/><rect width="455" height="132.336" x="570.5" fill="none" style="stroke:#000;stroke-width:2" y="534.258"/><text x="585.5" y="547.325" fill="#000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacing" textLength="21">alt</text><text x="651.5" y="546.468" fill="#000" font-family="sans-serif" font-size="11" font-weight="bold" lengthAdjust="spacing" textLength="280">[complete unbonding, all shares removed]</text><polygon fill="#A80036" points="981.5 568.523 991.5 572.523 981.5 576.523 985.5 572.523" style="stroke:#a80036;stroke-width:1"/><line style="stroke:#a80036;stroke-width:1" x1="615.5" x2="987.5" y1="572.523" y2="572.523"/><text x="622.5" y="567.457" fill="#000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="164">remove delegation object</text><line style="stroke:#000;stroke-width:1;stroke-dasharray:2,2" x1="570.5" x2="1025.5" y1="581.523" y2="581.523"/><text x="575.5" y="591.734" fill="#000" font-family="sans-serif" font-size="11" font-weight="bold" lengthAdjust="spacing" textLength="420">[there are still shares delegated (not a complete undbonding)]</text><polygon fill="#A80036" points="981.5 612.461 991.5 616.461 981.5 620.461 985.5 616.461" style="stroke:#a80036;stroke-width:1"/><line style="stroke:#a80036;stroke-width:1" x1="615.5" x2="987.5" y1="616.461" y2="616.461"/><text x="622.5" y="611.395" fill="#000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="159">update delegation object</text><line style="stroke:#a80036;stroke-width:1" x1="615.5" x2="657.5" y1="645.594" y2="645.594"/><line style="stroke:#a80036;stroke-width:1" x1="657.5" x2="657.5" y1="645.594" y2="658.594"/><line style="stroke:#a80036;stroke-width:1" x1="616.5" x2="657.5" y1="658.594" y2="658.594"/><polygon fill="#A80036" points="626.5 654.594 616.5 658.594 626.5 662.594 622.5 658.594" style="stroke:#a80036;stroke-width:1"/><text x="622.5" y="640.528" fill="#000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="189">AfterDelegationModified hook</text><polygon fill="#A80036" points="981.5 690.727 991.5 694.727 981.5 698.727 985.5 694.727" style="stroke:#a80036;stroke-width:1"/><line style="stroke:#a80036;stroke-width:1" x1="615.5" x2="987.5" y1="694.727" y2="694.727"/><text x="622.5" y="689.661" fill="#000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="188">update validator power index</text><polygon fill="#A80036" points="981.5 719.859 991.5 723.859 981.5 727.859 985.5 723.859" style="stroke:#a80036;stroke-width:1"/><line style="stroke:#a80036;stroke-width:1" x1="615.5" x2="987.5" y1="723.859" y2="723.859"/><text x="622.5" y="718.793" fill="#000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="347">update validator information (including token amount)</text><path fill="#EEE" d="M570.5,738.8594 L636.5,738.8594 L636.5,745.8594 L626.5,755.8594 L570.5,755.8594 L570.5,738.8594" style="stroke:#000;stroke-width:1"/><rect width="835" height="56.266" x="570.5" fill="none" style="stroke:#000;stroke-width:2" y="738.859"/><text x="585.5" y="751.926" fill="#000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacing" textLength="21">alt</text><text x="651.5" y="751.07" fill="#000" font-family="sans-serif" font-size="11" font-weight="bold" lengthAdjust="spacing" textLength="393">[validator status is &quot;unbonded&quot; and it has no more tokens]</text><polygon fill="#A80036" points="981.5 778.125 991.5 782.125 981.5 786.125 985.5 782.125" style="stroke:#a80036;stroke-width:1"/><line style="stroke:#a80036;stroke-width:1" x1="615.5" x2="987.5" y1="782.125" y2="782.125"/><text x="622.5" y="777.059" fill="#000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="125">delete the validator</text><path fill="#FBFB77" d="M998,760.9922 L998,785.9922 L1386,785.9922 L1386,770.9922 L1376,760.9922 L998,760.9922" filter="url(#f1harfv0wr5n65)" style="stroke:#a80036;stroke-width:1"/><path fill="#FBFB77" d="M1376,760.9922 L1376,770.9922 L1386,770.9922 L1376,760.9922" style="stroke:#a80036;stroke-width:1"/><text x="1004" y="778.059" fill="#000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="367">otherwise, do this in EndBlock once validator is unbonded</text><path fill="#EEE" d="M570.5,816.125 L636.5,816.125 L636.5,823.125 L626.5,833.125 L570.5,833.125 L570.5,816.125" style="stroke:#000;stroke-width:1"/><rect width="572" height="46.266" x="570.5" fill="none" style="stroke:#000;stroke-width:2" y="816.125"/><text x="585.5" y="829.192" fill="#000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacing" textLength="21">alt</text><text x="651.5" y="828.335" fill="#000" font-family="sans-serif" font-size="11" font-weight="bold" lengthAdjust="spacing" textLength="139">[validator is bonded]</text><polygon fill="#A80036" points="1067 850.391 1077 854.391 1067 858.391 1071 854.391" style="stroke:#a80036;stroke-width:1"/><line style="stroke:#a80036;stroke-width:1" x1="615.5" x2="1073" y1="854.391" y2="854.391"/><text x="622.5" y="849.325" fill="#000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="321">send tokens from bonded pool to not bonded pool</text><line style="stroke:#a80036;stroke-width:1" x1="77.5" x2="119.5" y1="890.523" y2="890.523"/><line style="stroke:#a80036;stroke-width:1" x1="119.5" x2="119.5" y1="890.523" y2="903.523"/><line style="stroke:#a80036;stroke-width:1" x1="78.5" x2="119.5" y1="903.523" y2="903.523"/><polygon fill="#A80036" points="88.5 899.523 78.5 903.523 88.5 907.523 84.5 903.523" style="stroke:#a80036;stroke-width:1"/><text x="84.5" y="885.457" fill="#000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="524">emit event : EventTypeUnbond(delAddr, valAddr, tokenAmount, completion time)</text></g></svg>