<svg xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink" width="1929" height="1931" contentScriptType="application/ecmascript" contentStyleType="text/css" preserveAspectRatio="none" style="width:1929px;height:1931px" version="1.1" viewBox="0 0 1929 1931" zoomAndPan="magnify"><defs><filter id="fcmqo0ou3ae7m" width="300%" height="300%" x="-1" y="-1"><feGaussianBlur result="blurOut" stdDeviation="2"/><feColorMatrix in="blurOut" result="blurOut2" type="matrix" values="0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 .4 0"/><feOffset dx="4" dy="4" in="blurOut2" result="blurOut3"/><feBlend in="SourceGraphic" in2="blurOut3" mode="normal"/></filter></defs><g><text x="723.5" y="28.708" fill="#000" font-family="sans-serif" font-size="18" lengthAdjust="spacing" textLength="478">Delegating (currently undelegated funds delegator)</text><rect width="711.5" height="46.266" x="29" y="148.383" fill="#FFF" filter="url(#fcmqo0ou3ae7m)" style="stroke:#000;stroke-width:2"/><rect width="842" height="158.336" x="84" y="208.648" fill="#FFF" filter="url(#fcmqo0ou3ae7m)" style="stroke:#000;stroke-width:2"/><rect width="842" height="56.938" x="84" fill="#FFF" style="stroke:none;stroke-width:1" y="310.047"/><rect width="1351.5" height="883.867" x="563.5" y="380.984" fill="#FFF" filter="url(#fcmqo0ou3ae7m)" style="stroke:#000;stroke-width:2"/><rect width="863" height="454.531" x="1042" y="434.25" fill="#FFF" filter="url(#fcmqo0ou3ae7m)" style="stroke:#000;stroke-width:2"/><rect width="843" height="339.133" x="1052" y="542.648" fill="#FFF" filter="url(#fcmqo0ou3ae7m)" style="stroke:#000;stroke-width:2"/><rect width="813" height="90.203" x="1072" y="651.047" fill="#FFF" filter="url(#fcmqo0ou3ae7m)" style="stroke:#000;stroke-width:2"/><rect width="813" height="43.938" x="1072" fill="#FFF" style="stroke:none;stroke-width:1" y="697.313"/><rect width="620" height="119.531" x="1062" y="755.25" fill="#FFF" filter="url(#fcmqo0ou3ae7m)" style="stroke:#000;stroke-width:2"/><rect width="600" height="46.266" x="1072" y="821.516" fill="#FFF" filter="url(#fcmqo0ou3ae7m)" style="stroke:#000;stroke-width:2"/><rect width="1351.5" height="339.938" x="563.5" fill="#FFF" style="stroke:none;stroke-width:1" y="924.914"/><rect width="672.5" height="90.203" x="583.5" y="946.719" fill="#FFF" filter="url(#fcmqo0ou3ae7m)" style="stroke:#000;stroke-width:2"/><rect width="672.5" height="43.938" x="583.5" fill="#FFF" style="stroke:none;stroke-width:1" y="992.984"/><rect width="1311.5" height="206.93" x="573.5" y="1050.922" fill="#FFF" filter="url(#fcmqo0ou3ae7m)" style="stroke:#000;stroke-width:2"/><rect width="672.5" height="46.266" x="583.5" y="1146.32" fill="#FFF" filter="url(#fcmqo0ou3ae7m)" style="stroke:#000;stroke-width:2"/><rect width="1663" height="71.398" x="222" y="1519.914" fill="#FFF" filter="url(#fcmqo0ou3ae7m)" style="stroke:#000;stroke-width:2"/><line style="stroke:#a80036;stroke-width:1;stroke-dasharray:5,5" x1="120" x2="120" y1="102.25" y2="1863.508"/><line style="stroke:#a80036;stroke-width:1;stroke-dasharray:5,5" x1="661.5" x2="661.5" y1="102.25" y2="1863.508"/><line style="stroke:#a80036;stroke-width:1;stroke-dasharray:5,5" x1="920.5" x2="920.5" y1="102.25" y2="1863.508"/><line style="stroke:#a80036;stroke-width:1;stroke-dasharray:5,5" x1="1164" x2="1164" y1="102.25" y2="1863.508"/><line style="stroke:#a80036;stroke-width:1;stroke-dasharray:5,5" x1="1597" x2="1597" y1="102.25" y2="1863.508"/><line style="stroke:#a80036;stroke-width:1;stroke-dasharray:5,5" x1="1746" x2="1746" y1="102.25" y2="1863.508"/><line style="stroke:#a80036;stroke-width:1;stroke-dasharray:5,5" x1="1853" x2="1853" y1="102.25" y2="1863.508"/><rect width="158" height="30.297" x="39" y="66.953" fill="#FEFECE" filter="url(#fcmqo0ou3ae7m)" style="stroke:#a80036;stroke-width:1.5"/><text x="46" y="86.948" fill="#000" font-family="sans-serif" font-size="14" lengthAdjust="spacing" textLength="144">msgServer (staking)</text><rect width="158" height="30.297" x="39" y="1862.508" fill="#FEFECE" filter="url(#fcmqo0ou3ae7m)" style="stroke:#a80036;stroke-width:1.5"/><text x="46" y="1882.503" fill="#000" font-family="sans-serif" font-size="14" lengthAdjust="spacing" textLength="144">msgServer (staking)</text><rect width="133" height="30.297" x="593.5" y="66.953" fill="#FEFECE" filter="url(#fcmqo0ou3ae7m)" style="stroke:#a80036;stroke-width:1.5"/><text x="600.5" y="86.948" fill="#000" font-family="sans-serif" font-size="14" lengthAdjust="spacing" textLength="119">keeper (staking)</text><rect width="133" height="30.297" x="593.5" y="1862.508" fill="#FEFECE" filter="url(#fcmqo0ou3ae7m)" style="stroke:#a80036;stroke-width:1.5"/><text x="600.5" y="1882.503" fill="#000" font-family="sans-serif" font-size="14" lengthAdjust="spacing" textLength="119">keeper (staking)</text><rect width="77" height="30.297" x="880.5" y="66.953" fill="#FEFECE" filter="url(#fcmqo0ou3ae7m)" style="stroke:#a80036;stroke-width:1.5"/><text x="887.5" y="86.948" fill="#000" font-family="sans-serif" font-size="14" lengthAdjust="spacing" textLength="63">validator</text><rect width="77" height="30.297" x="880.5" y="1862.508" fill="#FEFECE" filter="url(#fcmqo0ou3ae7m)" style="stroke:#a80036;stroke-width:1.5"/><text x="887.5" y="1882.503" fill="#000" font-family="sans-serif" font-size="14" lengthAdjust="spacing" textLength="63">validator</text><rect width="160" height="30.297" x="1082" y="66.953" fill="#FEFECE" filter="url(#fcmqo0ou3ae7m)" style="stroke:#a80036;stroke-width:1.5"/><text x="1089" y="86.948" fill="#000" font-family="sans-serif" font-size="14" lengthAdjust="spacing" textLength="146">keeper.bankKeeper</text><rect width="160" height="30.297" x="1082" y="1862.508" fill="#FEFECE" filter="url(#fcmqo0ou3ae7m)" style="stroke:#a80036;stroke-width:1.5"/><text x="1089" y="1882.503" fill="#000" font-family="sans-serif" font-size="14" lengthAdjust="spacing" textLength="146">keeper.bankKeeper</text><rect width="126" height="30.297" x="1532" y="66.953" fill="#FEFECE" filter="url(#fcmqo0ou3ae7m)" style="stroke:#a80036;stroke-width:1.5"/><text x="1539" y="86.948" fill="#000" font-family="sans-serif" font-size="14" lengthAdjust="spacing" textLength="112">vestingAccount</text><rect width="126" height="30.297" x="1532" y="1862.508" fill="#FEFECE" filter="url(#fcmqo0ou3ae7m)" style="stroke:#a80036;stroke-width:1.5"/><text x="1539" y="1882.503" fill="#000" font-family="sans-serif" font-size="14" lengthAdjust="spacing" textLength="112">vestingAccount</text><rect width="145" height="30.297" x="1672" y="66.953" fill="#FEFECE" filter="url(#fcmqo0ou3ae7m)" style="stroke:#a80036;stroke-width:1.5"/><text x="1679" y="86.948" fill="#000" font-family="sans-serif" font-size="14" lengthAdjust="spacing" textLength="131">ctx.EventManager</text><rect width="145" height="30.297" x="1672" y="1862.508" fill="#FEFECE" filter="url(#fcmqo0ou3ae7m)" style="stroke:#a80036;stroke-width:1.5"/><text x="1679" y="1882.503" fill="#000" font-family="sans-serif" font-size="14" lengthAdjust="spacing" textLength="131">ctx.EventManager</text><text x="1831" y="98.948" fill="#000" font-family="sans-serif" font-size="14" lengthAdjust="spacing" textLength="38">store</text><path fill="#FEFECE" d="M1835,49.9531 C1835,39.9531 1853,39.9531 1853,39.9531 C1853,39.9531 1871,39.9531 1871,49.9531 L1871,75.9531 C1871,85.9531 1853,85.9531 1853,85.9531 C1853,85.9531 1835,85.9531 1835,75.9531 L1835,49.9531" filter="url(#fcmqo0ou3ae7m)" style="stroke:#000;stroke-width:1.5"/><path fill="none" d="M1835,49.9531 C1835,59.9531 1853,59.9531 1853,59.9531 C1853,59.9531 1871,59.9531 1871,49.9531" style="stroke:#000;stroke-width:1.5"/><text x="1831" y="1875.503" fill="#000" font-family="sans-serif" font-size="14" lengthAdjust="spacing" textLength="38">store</text><path fill="#FEFECE" d="M1835,1888.8047 C1835,1878.8047 1853,1878.8047 1853,1878.8047 C1853,1878.8047 1871,1878.8047 1871,1888.8047 L1871,1914.8047 C1871,1924.8047 1853,1924.8047 1853,1924.8047 C1853,1924.8047 1835,1924.8047 1835,1914.8047 L1835,1888.8047" filter="url(#fcmqo0ou3ae7m)" style="stroke:#000;stroke-width:1.5"/><path fill="none" d="M1835,1888.8047 C1835,1898.8047 1853,1898.8047 1853,1898.8047 C1853,1898.8047 1871,1898.8047 1871,1888.8047" style="stroke:#000;stroke-width:1.5"/><polygon fill="#A80036" points="650 129.383 660 133.383 650 137.383 654 133.383" style="stroke:#a80036;stroke-width:1"/><line style="stroke:#a80036;stroke-width:1" x1="120" x2="656" y1="133.383" y2="133.383"/><text x="127" y="128.317" fill="#000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="518">Delegate(Context, DelegatorAddress, Amount, Validator, tokenSrc := Unbonded)</text><path fill="#EEE" d="M29,148.3828 L95,148.3828 L95,155.3828 L85,165.3828 L29,165.3828 L29,148.3828" style="stroke:#000;stroke-width:1"/><rect width="711.5" height="46.266" x="29" fill="none" style="stroke:#000;stroke-width:2" y="148.383"/><text x="44" y="161.45" fill="#000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacing" textLength="21">alt</text><text x="110" y="160.593" fill="#000" font-family="sans-serif" font-size="11" font-weight="bold" lengthAdjust="spacing" textLength="336">[exchange rate is invalid (tokens in validator is 0)]</text><polygon fill="#A80036" points="131 182.648 121 186.648 131 190.648 127 186.648" style="stroke:#a80036;stroke-width:1"/><line style="stroke:#a80036;stroke-width:1;stroke-dasharray:2,2" x1="125" x2="661" y1="186.648" y2="186.648"/><text x="137" y="181.583" fill="#000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="31">error</text><path fill="#EEE" d="M84,208.6484 L150,208.6484 L150,215.6484 L140,225.6484 L84,225.6484 L84,208.6484" style="stroke:#000;stroke-width:1"/><rect width="842" height="158.336" x="84" fill="none" style="stroke:#000;stroke-width:2" y="208.648"/><text x="99" y="221.715" fill="#000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacing" textLength="21">alt</text><text x="165" y="220.859" fill="#000" font-family="sans-serif" font-size="11" font-weight="bold" lengthAdjust="spacing" textLength="184">[perform a new delegation]</text><line style="stroke:#a80036;stroke-width:1" x1="662" x2="704" y1="246.914" y2="246.914"/><line style="stroke:#a80036;stroke-width:1" x1="704" x2="704" y1="246.914" y2="259.914"/><line style="stroke:#a80036;stroke-width:1" x1="663" x2="704" y1="259.914" y2="259.914"/><polygon fill="#A80036" points="673 255.914 663 259.914 673 263.914 669 259.914" style="stroke:#a80036;stroke-width:1"/><text x="669" y="241.848" fill="#000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="245">delegation := create delegation object</text><line style="stroke:#a80036;stroke-width:1" x1="662" x2="704" y1="289.047" y2="289.047"/><line style="stroke:#a80036;stroke-width:1" x1="704" x2="704" y1="289.047" y2="302.047"/><line style="stroke:#a80036;stroke-width:1" x1="663" x2="704" y1="302.047" y2="302.047"/><polygon fill="#A80036" points="673 298.047 663 302.047 673 306.047 669 302.047" style="stroke:#a80036;stroke-width:1"/><text x="669" y="283.981" fill="#000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="197">BeforeDelegationCreated hook</text><path fill="#FBFB77" d="M94,274.4141 L94,299.4141 L653,299.4141 L653,284.4141 L643,274.4141 L94,274.4141" filter="url(#fcmqo0ou3ae7m)" style="stroke:#a80036;stroke-width:1"/><path fill="#FBFB77" d="M643,274.4141 L643,284.4141 L653,284.4141 L643,274.4141" style="stroke:#a80036;stroke-width:1"/><text x="100" y="291.481" fill="#000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="538">Calls IncrementValidatorPeriod (Used to calculate distribution) in keeper/validator.go</text><line style="stroke:#000;stroke-width:1;stroke-dasharray:2,2" x1="84" x2="926" y1="311.047" y2="311.047"/><text x="89" y="321.257" fill="#000" font-family="sans-serif" font-size="11" font-weight="bold" lengthAdjust="spacing" textLength="303">[delegation exists, more tokens being added]</text><line style="stroke:#a80036;stroke-width:1" x1="662" x2="704" y1="345.984" y2="345.984"/><line style="stroke:#a80036;stroke-width:1" x1="704" x2="704" y1="345.984" y2="358.984"/><line style="stroke:#a80036;stroke-width:1" x1="663" x2="704" y1="358.984" y2="358.984"/><polygon fill="#A80036" points="673 354.984 663 358.984 673 362.984 669 358.984" style="stroke:#a80036;stroke-width:1"/><text x="669" y="340.918" fill="#000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="199">BeforeDelegationModified hook</text><path fill="#FBFB77" d="M245,331.3516 L245,356.3516 L653,356.3516 L653,341.3516 L643,331.3516 L245,331.3516" filter="url(#fcmqo0ou3ae7m)" style="stroke:#a80036;stroke-width:1"/><path fill="#FBFB77" d="M643,331.3516 L643,341.3516 L653,341.3516 L643,331.3516" style="stroke:#a80036;stroke-width:1"/><text x="251" y="348.418" fill="#000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="387">withdraw current delegation rewards (and increment period)</text><path fill="#EEE" d="M563.5,380.9844 L629.5,380.9844 L629.5,387.9844 L619.5,397.9844 L563.5,397.9844 L563.5,380.9844" style="stroke:#000;stroke-width:1"/><rect width="1351.5" height="883.867" x="563.5" fill="none" style="stroke:#000;stroke-width:2" y="380.984"/><text x="578.5" y="394.051" fill="#000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacing" textLength="21">alt</text><text x="644.5" y="393.195" fill="#000" font-family="sans-serif" font-size="11" font-weight="bold" lengthAdjust="spacing" textLength="372">[delegating from an account (subtractTokens == true)]</text><polygon fill="#A80036" points="1152 415.25 1162 419.25 1152 423.25 1156 419.25" style="stroke:#a80036;stroke-width:1"/><line style="stroke:#a80036;stroke-width:1" x1="662" x2="1158" y1="419.25" y2="419.25"/><text x="669" y="414.184" fill="#000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="239">DelegateCoinsFromAccountToModule</text><path fill="#EEE" d="M1042,434.25 L1442,434.25 L1442,441.25 L1432,451.25 L1042,451.25 L1042,434.25" style="stroke:#000;stroke-width:1"/><rect width="863" height="454.531" x="1042" fill="none" style="stroke:#000;stroke-width:2" y="434.25"/><text x="1057" y="447.317" fill="#000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacing" textLength="355">DelegateCoinsFromAccountToModule function</text><line style="stroke:#a80036;stroke-width:1" x1="1164" x2="1206" y1="472.516" y2="472.516"/><line style="stroke:#a80036;stroke-width:1" x1="1206" x2="1206" y1="472.516" y2="485.516"/><line style="stroke:#a80036;stroke-width:1" x1="1165" x2="1206" y1="485.516" y2="485.516"/><polygon fill="#A80036" points="1175 481.516 1165 485.516 1175 489.516 1171 485.516" style="stroke:#a80036;stroke-width:1"/><text x="1171" y="467.45" fill="#000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="239">DelegateCoinsFromAccountToModule</text><line style="stroke:#a80036;stroke-width:1" x1="1164" x2="1206" y1="514.648" y2="514.648"/><line style="stroke:#a80036;stroke-width:1" x1="1206" x2="1206" y1="514.648" y2="527.648"/><line style="stroke:#a80036;stroke-width:1" x1="1165" x2="1206" y1="527.648" y2="527.648"/><polygon fill="#A80036" points="1175 523.648 1165 527.648 1175 531.648 1171 527.648" style="stroke:#a80036;stroke-width:1"/><text x="1171" y="509.582" fill="#000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="93">DelegateCoins</text><path fill="#EEE" d="M1052,542.6484 L1275,542.6484 L1275,549.6484 L1265,559.6484 L1052,559.6484 L1052,542.6484" style="stroke:#000;stroke-width:1"/><rect width="843" height="339.133" x="1052" fill="none" style="stroke:#000;stroke-width:2" y="542.648"/><text x="1067" y="555.715" fill="#000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacing" textLength="178">DelegateCoins function</text><line style="stroke:#a80036;stroke-width:1;stroke-dasharray:2,2" x1="1164" x2="1206" y1="580.914" y2="580.914"/><line style="stroke:#a80036;stroke-width:1;stroke-dasharray:2,2" x1="1206" x2="1206" y1="580.914" y2="593.914"/><line style="stroke:#a80036;stroke-width:1;stroke-dasharray:2,2" x1="1165" x2="1206" y1="593.914" y2="593.914"/><polygon fill="#A80036" points="1175 589.914 1165 593.914 1175 597.914 1171 593.914" style="stroke:#a80036;stroke-width:1"/><text x="1171" y="575.848" fill="#000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="419">Check the delegator has enough balances of all tokens delegated</text><line style="stroke:#a80036;stroke-width:1;stroke-dasharray:2,2" x1="1164" x2="1206" y1="623.047" y2="623.047"/><line style="stroke:#a80036;stroke-width:1;stroke-dasharray:2,2" x1="1206" x2="1206" y1="623.047" y2="636.047"/><line style="stroke:#a80036;stroke-width:1;stroke-dasharray:2,2" x1="1165" x2="1206" y1="636.047" y2="636.047"/><polygon fill="#A80036" points="1175 632.047 1165 636.047 1175 640.047 1171 636.047" style="stroke:#a80036;stroke-width:1"/><text x="1171" y="617.981" fill="#000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="370">Track delegation (register that it exists to keep track of it)</text><path fill="#EEE" d="M1072,651.0469 L1138,651.0469 L1138,658.0469 L1128,668.0469 L1072,668.0469 L1072,651.0469" style="stroke:#000;stroke-width:1"/><rect width="813" height="90.203" x="1072" fill="none" style="stroke:#000;stroke-width:2" y="651.047"/><text x="1087" y="664.114" fill="#000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacing" textLength="21">alt</text><text x="1153" y="663.257" fill="#000" font-family="sans-serif" font-size="11" font-weight="bold" lengthAdjust="spacing" textLength="204">[validator is currently bonded]</text><polygon fill="#A80036" points="1841 685.313 1851 689.313 1841 693.313 1845 689.313" style="stroke:#a80036;stroke-width:1"/><line style="stroke:#a80036;stroke-width:1;stroke-dasharray:2,2" x1="1164" x2="1847" y1="689.313" y2="689.313"/><text x="1171" y="684.247" fill="#000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="347">Transfer tokens from delegator to BondedTokensPool.</text><line style="stroke:#000;stroke-width:1;stroke-dasharray:2,2" x1="1072" x2="1885" y1="698.313" y2="698.313"/><text x="1077" y="708.523" fill="#000" font-family="sans-serif" font-size="11" font-weight="bold" lengthAdjust="spacing" textLength="312">[validator is currently unbonded or unbonding]</text><polygon fill="#A80036" points="1841 729.25 1851 733.25 1841 737.25 1845 733.25" style="stroke:#a80036;stroke-width:1"/><line style="stroke:#a80036;stroke-width:1;stroke-dasharray:2,2" x1="1164" x2="1847" y1="733.25" y2="733.25"/><text x="1171" y="728.184" fill="#000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="369">Transfer tokens from delegator to NotBondedTokensPool.</text><path fill="#EEE" d="M1062,755.25 L1299,755.25 L1299,762.25 L1289,772.25 L1062,772.25 L1062,755.25" style="stroke:#000;stroke-width:1"/><rect width="620" height="119.531" x="1062" fill="none" style="stroke:#000;stroke-width:2" y="755.25"/><text x="1077" y="768.317" fill="#000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacing" textLength="192">trackDelegation function</text><line style="stroke:#a80036;stroke-width:1" x1="1164" x2="1206" y1="793.516" y2="793.516"/><line style="stroke:#a80036;stroke-width:1" x1="1206" x2="1206" y1="793.516" y2="806.516"/><line style="stroke:#a80036;stroke-width:1" x1="1165" x2="1206" y1="806.516" y2="806.516"/><polygon fill="#A80036" points="1175 802.516 1165 806.516 1175 810.516 1171 806.516" style="stroke:#a80036;stroke-width:1"/><text x="1171" y="788.45" fill="#000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="101">trackDelegation</text><path fill="#EEE" d="M1072,821.5156 L1138,821.5156 L1138,828.5156 L1128,838.5156 L1072,838.5156 L1072,821.5156" style="stroke:#000;stroke-width:1"/><rect width="600" height="46.266" x="1072" fill="none" style="stroke:#000;stroke-width:2" y="821.516"/><text x="1087" y="834.582" fill="#000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacing" textLength="21">alt</text><text x="1153" y="833.726" fill="#000" font-family="sans-serif" font-size="11" font-weight="bold" lengthAdjust="spacing" textLength="214">[delegator is a vesting account]</text><polygon fill="#A80036" points="1585 855.781 1595 859.781 1585 863.781 1589 859.781" style="stroke:#a80036;stroke-width:1"/><line style="stroke:#a80036;stroke-width:1" x1="1164" x2="1591" y1="859.781" y2="859.781"/><text x="1171" y="854.715" fill="#000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="182">keep track of this delegation</text><polygon fill="#A80036" points="673 912.914 663 916.914 673 920.914 669 916.914" style="stroke:#a80036;stroke-width:1"/><line style="stroke:#a80036;stroke-width:1;stroke-dasharray:2,2" x1="667" x2="1163" y1="916.914" y2="916.914"/><text x="679" y="911.848" fill="#000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="79">nil (success)</text><line style="stroke:#000;stroke-width:1;stroke-dasharray:2,2" x1="563.5" x2="1915" y1="925.914" y2="925.914"/><text x="568.5" y="936.125" fill="#000" font-family="sans-serif" font-size="11" font-weight="bold" lengthAdjust="spacing" textLength="390">[moving tokens between pools (subtractTokens == false)]</text><path fill="#EEE" d="M583.5,946.7188 L649.5,946.7188 L649.5,953.7188 L639.5,963.7188 L583.5,963.7188 L583.5,946.7188" style="stroke:#000;stroke-width:1"/><rect width="672.5" height="90.203" x="583.5" fill="none" style="stroke:#000;stroke-width:2" y="946.719"/><text x="598.5" y="959.786" fill="#000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacing" textLength="21">alt</text><text x="664.5" y="958.929" fill="#000" font-family="sans-serif" font-size="11" font-weight="bold" lengthAdjust="spacing" textLength="393">[delegator tokens are not bonded but validator is bonded]</text><polygon fill="#A80036" points="1152 980.984 1162 984.984 1152 988.984 1156 984.984" style="stroke:#a80036;stroke-width:1"/><line style="stroke:#a80036;stroke-width:1" x1="662" x2="1158" y1="984.984" y2="984.984"/><text x="669" y="979.918" fill="#000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="436">SendCoinsFromModuleToModule(notBondedPool, bondedPool, coins)</text><line style="stroke:#000;stroke-width:1;stroke-dasharray:2,2" x1="583.5" x2="1256" y1="993.984" y2="993.984"/><text x="588.5" y="1004.195" fill="#000" font-family="sans-serif" font-size="11" font-weight="bold" lengthAdjust="spacing" textLength="393">[delegator tokens are bonded but validator is not bonded]</text><polygon fill="#A80036" points="1152 1024.922 1162 1028.922 1152 1032.922 1156 1028.922" style="stroke:#a80036;stroke-width:1"/><line style="stroke:#a80036;stroke-width:1" x1="662" x2="1158" y1="1028.922" y2="1028.922"/><text x="669" y="1023.856" fill="#000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="436">SendCoinsFromModuleToModule(bondedPool, notBondedPool, coins)</text><path fill="#EEE" d="M573.5,1050.9219 L764.5,1050.9219 L764.5,1057.9219 L754.5,1067.9219 L573.5,1067.9219 L573.5,1050.9219" style="stroke:#000;stroke-width:1"/><rect width="1311.5" height="206.93" x="573.5" fill="none" style="stroke:#000;stroke-width:2" y="1050.922"/><text x="588.5" y="1063.989" fill="#000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacing" textLength="146">SendCoins function</text><line style="stroke:#a80036;stroke-width:1" x1="1164" x2="1206" y1="1089.188" y2="1089.188"/><line style="stroke:#a80036;stroke-width:1" x1="1206" x2="1206" y1="1089.188" y2="1102.188"/><line style="stroke:#a80036;stroke-width:1" x1="1165" x2="1206" y1="1102.188" y2="1102.188"/><polygon fill="#A80036" points="1175 1098.188 1165 1102.188 1175 1106.188 1171 1102.188" style="stroke:#a80036;stroke-width:1"/><text x="1171" y="1084.122" fill="#000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="67">SendCoins</text><polygon fill="#A80036" points="1734.5 1127.32 1744.5 1131.32 1734.5 1135.32 1738.5 1131.32" style="stroke:#a80036;stroke-width:1"/><line style="stroke:#a80036;stroke-width:1" x1="1164" x2="1740.5" y1="1131.32" y2="1131.32"/><text x="1171" y="1126.254" fill="#000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="244">Emit TransferEvent(to, from, amount)</text><path fill="#EEE" d="M583.5,1146.3203 L649.5,1146.3203 L649.5,1153.3203 L639.5,1163.3203 L583.5,1163.3203 L583.5,1146.3203" style="stroke:#000;stroke-width:1"/><rect width="672.5" height="46.266" x="583.5" fill="none" style="stroke:#000;stroke-width:2" y="1146.32"/><text x="598.5" y="1159.387" fill="#000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacing" textLength="21">alt</text><text x="664.5" y="1158.531" fill="#000" font-family="sans-serif" font-size="11" font-weight="bold" lengthAdjust="spacing" textLength="369">[amount of spendable (balance - locked) coins too low]</text><polygon fill="#A80036" points="673 1180.586 663 1184.586 673 1188.586 669 1184.586" style="stroke:#a80036;stroke-width:1"/><line style="stroke:#a80036;stroke-width:1;stroke-dasharray:2,2" x1="667" x2="1163" y1="1184.586" y2="1184.586"/><text x="679" y="1179.52" fill="#000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="31">error</text><polygon fill="#A80036" points="1841 1216.719 1851 1220.719 1841 1224.719 1845 1220.719" style="stroke:#a80036;stroke-width:1"/><line style="stroke:#a80036;stroke-width:1" x1="1164" x2="1847" y1="1220.719" y2="1220.719"/><text x="1171" y="1215.653" fill="#000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="190">subtract balance from sender</text><polygon fill="#A80036" points="1841 1245.852 1851 1249.852 1841 1253.852 1845 1249.852" style="stroke:#a80036;stroke-width:1"/><line style="stroke:#a80036;stroke-width:1" x1="1164" x2="1847" y1="1249.852" y2="1249.852"/><text x="1171" y="1244.786" fill="#000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="154">add balance to recipient</text><polygon fill="#A80036" points="909 1288.984 919 1292.984 909 1296.984 913 1292.984" style="stroke:#a80036;stroke-width:1"/><line style="stroke:#a80036;stroke-width:1" x1="662" x2="915" y1="1292.984" y2="1292.984"/><text x="669" y="1287.918" fill="#000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="125">AddTokensFromDel</text><line style="stroke:#a80036;stroke-width:1" x1="921" x2="963" y1="1335.75" y2="1335.75"/><line style="stroke:#a80036;stroke-width:1" x1="963" x2="963" y1="1335.75" y2="1348.75"/><line style="stroke:#a80036;stroke-width:1" x1="922" x2="963" y1="1348.75" y2="1348.75"/><polygon fill="#A80036" points="932 1344.75 922 1348.75 932 1352.75 928 1348.75" style="stroke:#a80036;stroke-width:1"/><text x="928" y="1330.684" fill="#000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="229">calculate number of shares to issue</text><path fill="#FBFB77" d="M278,1305.9844 L278,1360.9844 L912,1360.9844 L912,1315.9844 L902,1305.9844 L278,1305.9844" filter="url(#fcmqo0ou3ae7m)" style="stroke:#a80036;stroke-width:1"/><path fill="#FBFB77" d="M902,1305.9844 L902,1315.9844 L912,1315.9844 L902,1305.9844" style="stroke:#a80036;stroke-width:1"/><text x="284" y="1323.051" fill="#000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="455">If there are no shares (validator being created) then 1 token = 1 share.</text><text x="284" y="1338.184" fill="#000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="207">If there are already shares, then</text><text x="284" y="1353.317" fill="#000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="613">added shares = (added tokens amount) * (current validator shares) / (current validator tokens)</text><line style="stroke:#a80036;stroke-width:1" x1="921" x2="963" y1="1391.516" y2="1391.516"/><line style="stroke:#a80036;stroke-width:1" x1="963" x2="963" y1="1391.516" y2="1404.516"/><line style="stroke:#a80036;stroke-width:1" x1="922" x2="963" y1="1404.516" y2="1404.516"/><polygon fill="#A80036" points="932 1400.516 922 1404.516 932 1408.516 928 1404.516" style="stroke:#a80036;stroke-width:1"/><text x="928" y="1386.45" fill="#000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="216">add delegated tokens to validator</text><polygon fill="#A80036" points="673 1429.648 663 1433.648 673 1437.648 669 1433.648" style="stroke:#a80036;stroke-width:1"/><line style="stroke:#a80036;stroke-width:1;stroke-dasharray:2,2" x1="667" x2="920" y1="1433.648" y2="1433.648"/><text x="679" y="1428.582" fill="#000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="148">validator, addedShares</text><polygon fill="#A80036" points="1841 1458.781 1851 1462.781 1841 1466.781 1845 1462.781" style="stroke:#a80036;stroke-width:1"/><line style="stroke:#a80036;stroke-width:1" x1="662" x2="1847" y1="1462.781" y2="1462.781"/><text x="669" y="1457.715" fill="#000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="142">update validator state</text><line style="stroke:#a80036;stroke-width:1" x1="662" x2="704" y1="1491.914" y2="1491.914"/><line style="stroke:#a80036;stroke-width:1" x1="704" x2="704" y1="1491.914" y2="1504.914"/><line style="stroke:#a80036;stroke-width:1" x1="663" x2="704" y1="1504.914" y2="1504.914"/><polygon fill="#A80036" points="673 1500.914 663 1504.914 673 1508.914 669 1504.914" style="stroke:#a80036;stroke-width:1"/><text x="669" y="1486.848" fill="#000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="202">calculate new validator&apos;s power</text><path fill="#FBFB77" d="M34,1477.2813 L34,1502.2813 L653,1502.2813 L653,1487.2813 L643,1477.2813 L34,1477.2813" filter="url(#fcmqo0ou3ae7m)" style="stroke:#a80036;stroke-width:1"/><path fill="#FBFB77" d="M643,1477.2813 L643,1487.2813 L653,1487.2813 L643,1477.2813" style="stroke:#a80036;stroke-width:1"/><text x="40" y="1494.348" fill="#000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="598">Number of tokens divided by PowerReduction (default: 1,000,000,000,000,000,000 = 10^18)</text><path fill="#EEE" d="M222,1519.9141 L288,1519.9141 L288,1526.9141 L278,1536.9141 L222,1536.9141 L222,1519.9141" style="stroke:#000;stroke-width:1"/><rect width="1663" height="71.398" x="222" fill="none" style="stroke:#000;stroke-width:2" y="1519.914"/><text x="237" y="1532.981" fill="#000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacing" textLength="21">alt</text><text x="303" y="1532.124" fill="#000" font-family="sans-serif" font-size="11" font-weight="bold" lengthAdjust="spacing" textLength="154">[validator is not jailed]</text><polygon fill="#A80036" points="1841 1566.746 1851 1570.746 1841 1574.746 1845 1570.746" style="stroke:#a80036;stroke-width:1"/><line style="stroke:#a80036;stroke-width:1" x1="662" x2="1847" y1="1570.746" y2="1570.746"/><text x="669" y="1565.68" fill="#000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="257">update validator&apos;s power in power index</text><path fill="#FBFB77" d="M232,1542.0469 L232,1582.0469 L653,1582.0469 L653,1552.0469 L643,1542.0469 L232,1542.0469" filter="url(#fcmqo0ou3ae7m)" style="stroke:#a80036;stroke-width:1"/><path fill="#FBFB77" d="M643,1542.0469 L643,1552.0469 L653,1552.0469 L643,1542.0469" style="stroke:#a80036;stroke-width:1"/><text x="238" y="1559.114" fill="#000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="400">the power index has entries shaped as 35 || power || address.</text><text x="238" y="1574.247" fill="#000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="356">This makes the validators sorted by power, high to low.</text><line style="stroke:#a80036;stroke-width:1" x1="662" x2="704" y1="1648.211" y2="1648.211"/><line style="stroke:#a80036;stroke-width:1" x1="704" x2="704" y1="1648.211" y2="1661.211"/><line style="stroke:#a80036;stroke-width:1" x1="663" x2="704" y1="1661.211" y2="1661.211"/><polygon fill="#A80036" points="673 1657.211 663 1661.211 673 1665.211 669 1661.211" style="stroke:#a80036;stroke-width:1"/><text x="669" y="1643.145" fill="#000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="189">AfterDelegationModified hook</text><path fill="#FBFB77" d="M5,1603.3125 L5,1688.3125 L653,1688.3125 L653,1613.3125 L643,1603.3125 L5,1603.3125" filter="url(#fcmqo0ou3ae7m)" style="stroke:#a80036;stroke-width:1"/><path fill="#FBFB77" d="M643,1603.3125 L643,1613.3125 L653,1613.3125 L643,1603.3125" style="stroke:#a80036;stroke-width:1"/><text x="11" y="1620.379" fill="#000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="154">Calls initializeDelegation</text><text x="11" y="1635.512" fill="#000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="162">Store the previous period</text><text x="11" y="1650.645" fill="#000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="284">Calculate the number of tokens from shares</text><text x="11" y="1665.778" fill="#000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="627">(shares the delegator has) * (tokens in delegation object)/(total tokens delegated to the validator)</text><text x="11" y="1680.911" fill="#000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="190">Store delegation starting info.</text><polygon fill="#A80036" points="131 1715.109 121 1719.109 131 1723.109 127 1719.109" style="stroke:#a80036;stroke-width:1"/><line style="stroke:#a80036;stroke-width:1;stroke-dasharray:2,2" x1="125" x2="661" y1="1719.109" y2="1719.109"/><text x="137" y="1714.043" fill="#000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="271">newShares (ignored by Delegate function)</text><line style="stroke:#a80036;stroke-width:1" x1="120" x2="162" y1="1748.242" y2="1748.242"/><line style="stroke:#a80036;stroke-width:1" x1="162" x2="162" y1="1748.242" y2="1761.242"/><line style="stroke:#a80036;stroke-width:1" x1="121" x2="162" y1="1761.242" y2="1761.242"/><polygon fill="#A80036" points="131 1757.242 121 1761.242 131 1765.242 127 1761.242" style="stroke:#a80036;stroke-width:1"/><text x="127" y="1743.176" fill="#000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="267">Emit event: Delegation(ValidatorAddress)</text><line style="stroke:#a80036;stroke-width:1" x1="120" x2="162" y1="1790.375" y2="1790.375"/><line style="stroke:#a80036;stroke-width:1" x1="162" x2="162" y1="1790.375" y2="1803.375"/><line style="stroke:#a80036;stroke-width:1" x1="121" x2="162" y1="1803.375" y2="1803.375"/><polygon fill="#A80036" points="131 1799.375 121 1803.375 131 1807.375 127 1803.375" style="stroke:#a80036;stroke-width:1"/><text x="127" y="1785.309" fill="#000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="260">Emit event: Message(DelegatorAddress)</text><line style="stroke:#a80036;stroke-width:1" x1="120" x2="162" y1="1832.508" y2="1832.508"/><line style="stroke:#a80036;stroke-width:1" x1="162" x2="162" y1="1832.508" y2="1845.508"/><line style="stroke:#a80036;stroke-width:1" x1="121" x2="162" y1="1845.508" y2="1845.508"/><polygon fill="#A80036" points="131 1841.508 121 1845.508 131 1849.508 127 1845.508" style="stroke:#a80036;stroke-width:1"/><text x="127" y="1827.442" fill="#000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="179">telemetry(Amount, Denom)</text></g></svg>